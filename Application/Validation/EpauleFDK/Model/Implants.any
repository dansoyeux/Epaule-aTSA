/* -------- IMPLANT LOADING --------
Position & Name for implants: 
Call to custom file based on template "InputPosition_ImplantName.any"
----------------------------- */


//Files with the original humeral implant position
#if CorrectHumImplantPos==0
#path INPUTPOSFILE "../Input/Implants/ImplantPositions/InputImplantJoint_" + INPUTPOS + ".any"
#include "<INPUTPOSFILE>" 
#endif

//Files with the corrected humeral implant position (in another directory)
#if CorrectHumImplantPos==1
#path INPUTPOSFILE "../Input/Implants/ImplantPositions/Fix_Humeral_Implant_Position/InputImplantJoint_" + INPUTPOS + ".any"
#include "<INPUTPOSFILE>" 
#endif



/* -------- GLENOID IMPLANT--------*/
Main.HumanModel.BodyModel.Right.ShoulderArm.Seg.Scapula = {
  
  AnyFolder &Param = Main.InputVariables.ImplantParameters;
  
  
  AnyRefNode GlenImplantPos = {
    sRel = .Param.GlenPosition.Position*.Mirror;
    ARel = .Param.GlenPosition.Rotation*.Mirror;
    
    // Center of the GlenImplant
    AnyRefNode GlenImplantCenter = {
      sRel = 0.001*{0,0,28.418720};
    };
    
    
    AnyDrawRefFrame drw = {
      Visible= Off;
      ScaleXYZ={1,1,1}/12;
      RGB = {1,0,0};
    }; 
    
    
    AnySurfSTL GleneSTL = {
      FileName = "../Input/Implants/ImplantModels/" + ..Param.ImplantNames.GlenoidName + ".stl";
      ScaleXYZ = {1,1,1}*0.001;
      AnyDrawSurf drw = {
        FileName = .FileName;
        RGB = {1,0.2,0}; // red
//        RGB = {0, 1, 0}; // green
//        RGB = {0, 0.2, 1}; // blue
        
        ScaleXYZ = {1,1,1}*0.001;
      };
    };      
    
    
  }; // GlenImplantPos
  
  
  
  
  
  
  
//  
//  // UP
//    AnyRefNode GlenImplantPos_up = {
//    sRel = 0.001*{-25.928136 , -45.408988 , -24.271015};
//    ARel = {
//      {-0.193467 , -0.149501 , 0.969649},
//      {-0.226877 , 0.968351 , 0.104034},
//      {-0.954514 , -0.199864 , -0.221263}
//      
//      };
//
//    
//    // Center of the GlenImplant
//    AnyRefNode GlenImplantCenter = {
//      sRel = 0.001*{0,0,28.418720};
//    };
//    
//    
//    AnyDrawRefFrame drw = {
//      Visible= Off;
//      ScaleXYZ={1,1,1}/12;
//      RGB = {1,0,0};
//    }; 
//    
//    
//    AnySurfSTL GleneSTL = {
//      FileName = "../Input/Implants/ImplantModels/" + ..Param.ImplantNames.GlenoidName + ".stl";
//      ScaleXYZ = {1,1,1}*0.001;
//      AnyDrawSurf drw = {
//        FileName = .FileName;
//        RGB = {1,0.2,0}; // red
//        
//        ScaleXYZ = {1,1,1}*0.001;
//      };
//    };      
//    
//    
//  }; // GlenImplantPos_up
//  
//    AnyRefNode ghProth_up = {
//    sRel = 0.001*{28.664689 , -39.58081 , -37.319763};   
//    ARel = {
//      {-0.193467 , -0.149501 , 0.969649},
//      {-0.226877 , 0.968351 , 0.104034},
//      {-0.954514 , -0.199864 , -0.221263}
//      
//      };
//    AnyDrawRefFrame drwref = {
//      Visible = Off;
//      RGB = {1,0,0};
//      ScaleXYZ = {1,1,1}/15;
//    }; 
//    
//  }; //ghProth_up
//    
    
//  // DOWN
//    AnyRefNode GlenImplantPos_down = {
//    sRel = 0.001*{-25.364074 , -35.538966 , -26.731333};
//    ARel = {
//        {-0.193467 , 0.257816 , 0.946626},
//        {-0.226877 , 0.926947 , -0.298824},
//        {-0.954514 , -0.27258 , -0.120842}
//        
//      };
//
//    
//    // Center of the GlenImplant
//    AnyRefNode GlenImplantCenter = {
//      sRel = 0.001*{0,0,28.418720};
//    };
//    
//    
//    AnyDrawRefFrame drw = {
//      Visible= Off;
//      ScaleXYZ={1,1,1}/12;
//      RGB = {1,0,0};
//    }; 
//    
//    
//    AnySurfSTL GleneSTL = {
//      FileName = "../Input/Implants/ImplantModels/" + ..Param.ImplantNames.GlenoidName + ".stl";
//      ScaleXYZ = {1,1,1}*0.001;
//      AnyDrawSurf drw = {
//        FileName = .FileName;
////        RGB = {1,0.2,0}; // red
////        RGB = {0, 1, 0}; // green
//        RGB = {0, 0.2, 1}; // blue
//        
//        ScaleXYZ = {1,1,1}*0.001;
//      };
//    };      
//    
//    
//  }; // GlenImplantPos_down
//  
//    AnyRefNode ghProth_down = {
//    sRel = 0.001*{27.966239 , -52.447563 , -34.119917};
//    ARel = {
//        {-0.193467 , 0.257816 , 0.946626},
//        {-0.226877 , 0.926947 , -0.298824},
//        {-0.954514 , -0.27258 , -0.120842}
//        
//      };
//    AnyDrawRefFrame drwref = {
//      Visible = On;
//      RGB = {0,0,1};
//      ScaleXYZ = {1,1,1}/15;
//    }; 
//    
//  }; //ghProth_down    
    
    
    
    
    
  
  
  
  gh = {
    
    AnyDrawRefFrame drwref = {
      Visible = Off;
      RGB = {0.5,0.6,0.3};
      ScaleXYZ = {1,1,1}/15;
    };
    
    //Old definition of ghProth (Lauranne)
    AnyRefNode ghProth = {
      ARel = ..Param.GlenPosition.Rotation;
      AnyDrawRefFrame drwref = {
        Visible = Off;
        RGB = {1,1,0};
        ScaleXYZ = {1,1,1}/15;
      }; 
      
    };
  };
  
  
  
  //ghProth is the center of a sphere fitted to glenoid implant surface (see script file)
  AnyRefNode ghProth = {
    sRel = .Param.GlenPosition.Center_Absolute;    
    ARel = .Param.GlenPosition.Rotation;
    AnyDrawRefFrame drwref = {
      Visible = Off;
      RGB = {1,0,0}; // red
//      RGB = {0,0,1}; // blue
      ScaleXYZ = {1,1,1}/15;
    }; 
    
  };//ghProth
  
  // ghProth oriented like aligned with the ISB scapula coordinate system
  AnyRefNode ghProth_ISB = {
    sRel = .Param.GlenPosition.Center_Absolute;    
    ARel={{ 0, 0, 1}, { 0, 1,0}, {-1, 0,0}};
     AnyDrawRefFrame drwref = {
      Visible = Off;
      RGB = {1,0,0}; // red
//      RGB = {0,0,1}; // blue
      ScaleXYZ = {1,1,1}/15;
    }; 

  };
  
  // ghProth oriented like aligned with the ISB scapula coordinate system
  AnyRefNode ghProth_ISB_up = {
    sRel = 0.001*{28.664689 , -39.58081 , -37.319763};    
    ARel={{ 0, 0, 1}, { 0, 1,0}, {-1, 0,0}};
     AnyDrawRefFrame drwref = {
      Visible = Off;
      RGB = {1,0,0};
      ScaleXYZ = {1,1,1}/15;
    }; 

  };  
  
};//Scapula


/* -------- HUMERAL IMPLANT--------*/
//Enlever cet offset en appliquant cet offset aux coordonnes de base de l'implant humeral
Main.HumanModel.BodyModel.Right.ShoulderArm.Seg.Humerus = {
  
  #if CorrectHumImplantPos==0
  AnyVec3 OffSet =-{-0.001379, 0.008999 , -0.009119};
  #endif
  
  #if CorrectHumImplantPos==1
  AnyVec3 OffSet =-{0, 0 ,0};
  #endif
  
  
  
  //Displays Humerus.gh node
  gh = {
    AnyDrawRefFrame drw = {
      Visible = Off;
      RGB = {0,1,0};
      ScaleXYZ = {1,1,1}/15;
      
    };
  };
  
  //  Modele osseux Humerus
  AnyRefNode HumerusBoneGeometryNode={ 
    sRel=.OffSet*.Mirror;
    AnyDrawRefFrame drw = {
      Visible= Off;
      ScaleXYZ={1,1,1}/15;
    };   
    
    AnyFolder &Param = Main.InputVariables.ImplantParameters;
    
    AnyRefNode HumImplantPos = {
      sRel = .Param.HumPosition.Position;
      ARel = .Param.HumPosition.Rotation;
      
      AnyDrawRefFrame drw = {
        Visible = Off;
        RGB={0,0,1};        
        ScaleXYZ={1,1,1}*0.06;
        
      };  
      AnySurfSTL ProtHumSTL = {
        FileName = "../Input/Implants/ImplantModels/" + ..Param.ImplantNames.HumerusName + ".stl";
        ScaleXYZ = {1,1,1}*0.001;
        
        AnyDrawSurf drw= {
          FileName = .FileName;
          RGB = {0.2,0.4,0.5};
          ScaleXYZ = {1,1,1}*0.001;
          Opacity = 0.5;
        };
        
      };    
    };
  };
  
  
};//Humerus





